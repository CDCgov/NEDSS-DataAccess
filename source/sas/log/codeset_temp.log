1                                           The SAS System          10:36 Wednesday, December 13, 2023

NOTE: Copyright (c) 2002-2010 by SAS Institute Inc., Cary, NC, USA. 
NOTE: SAS (r) Proprietary Software 9.3 (TS1M2) 
      Licensed to GENERAL DYNAMICS IT INC/CDC NEDSS 2, Site 70238317.
NOTE: This session is executing on the X64_DSRV12  platform.



NOTE: Enhanced analytical products:

SAS/ETS 12.1

NOTE: SAS initialization used:
      real time           0.37 seconds
      cpu time            0.32 seconds
      

NOTE: AUTOEXEC processing beginning; file is 
      D:\wildfly-10.0.0.Final\nedssdomain\Nedss\report\autoexec.sas.

NOTE: Libref RDBDATA was successfully assigned as follows: 
      Engine:        V9 
      Physical Name: D:\wildfly-10.0.0.Final\nedssdomain\Nedss\report\dw\etl\rdbdata
NOTE: Libref NBSFMT was successfully assigned as follows: 
      Engine:        V9 
      Physical Name: D:\wildfly-10.0.0.Final\nedssdomain\Nedss\report\format
NOTE: The V6 engine on this host is limited to read-only access of SAS data files without index 
      optimization.  V6 data files cannot be created or updated and V6 catalogs cannot be read.
NOTE: Libref LIBRARY was successfully assigned as follows: 
      Engine:        V6 
      Physical Name: D:\wildfly-10.0.0.Final\nedssdomain\Nedss\report\metadata

NOTE: AUTOEXEC processing completed.

1          /*----------------------------------------------------
2          
3           	CODESET TABLE
4          	This program should be part of the setup
5          	and needs to run only once before all other
6          	porgrams
7          
8          ------------------------------------------------------*/
9          %macro loadCodeSet;
10         /*Check to see if the libref has been assigned. If a libref is not assigned
11         then execute the macro called etllib defined in either autoexec.sas or etldevenv.sas*/
12         %if %SYSFUNC(LIBREF(nbs_ods)) NE 0 or
13         	%SYSFUNC(LIBREF(nbs_srt)) NE 0 or
14         	%SYSFUNC(LIBREF(nbs_rdb)) NE 0
15         %then %do;
16         %etllib;
17         %include etlpgm(etlmacro.sas);
18         %end;
19         
20         
21         /* totalidm.XLS
2                                           The SAS System          10:36 Wednesday, December 13, 2023

22         SELECT     	[Unique ID],
23         			[SRT Reference],
24         			format,
25         			label
26         FROM  imdbo.tblTOTALIDM
27         WHERE     (Status = 'Active') and [Unique ID] NOT IN ('------', '******')
28         ORDER BY [Unique ID]
29         */
30         /* Load the codeset data sets from Excel */
31         
32         
33         /*Proc Import datafile="&SAS_REPORT_HOME\metadata\totalidm.XLS" Replace Out=nbsfmt.totalidm
33       ! ;   Run;*/
34         
35         
36         Proc SQL;
37          Create table nbsfmt.totalidm as
38         	select
39         	unique_cd as unique_id 'unique_id',
40         	SRT_reference as SRT_reference 'SRT_reference',
41         	format as format 'format',
42         	label as label 'label'
43         	from nbs_srt.totalidm;
44         Quit;
45         
46         /*
47         %macro importfact (sheet, DSout);
48         	Proc Import datafile="&SAS_REPORT_HOME\metadata\imRDBmapping.xls" Replace Out=&DSout;
49         
50         	Sheet=&sheet;
51          Run;
52         %mend importfact;
53         
54         %importfact ('bmird',BMIRDcodeset);
55         %importfact ('sumcase',SUMcodeset);
56         %importfact ('labobs',LABcodeset);
57         %importfact ('morbidity',MORBcodeset);
58         %importfact ('treatment',TREATcodeset);
59         %importfact ('vaccination',VACCcodeset);
60         %importfact ('rubella',RUBcodeset);
61         %importfact ('pertussis',PERTcodeset);
62         %importfact ('crs',CRScodeset);
63         %importfact ('measles',MEAcodeset);
64         %importfact ('hepatitis',HEPcodeset);
65         %importfact ('person',PERScodeset);
66         %importfact ('org',ORGcodeset);
67         %importfact ('notification',NOTcodeset);
68         %importfact ('investigation',INVcodeset);
69         */
70         
71         Proc SQL;
72          Create table rdbdata.imrdbmapping as
73         	select unique_cd as UNIQUE_ID 'UNIQUE_ID',
74         	unique_name as unique_name 'unique_name',
3                                           The SAS System          10:36 Wednesday, December 13, 2023

75         	description as description 'description',
76         	DB_table as DB_table 'DB_table',
77         	DB_field as DB_field 'DB_field',
78         	RDB_table as RDB_table 'RDB_table',
79         	RDB_attribute as RDB_attribute 'RDB_attribute',
80         	other_attributes as other_attributes 'other_attributes',
81         	condition_cd as condition_cd 'condition_cd'
82         from nbs_srt.imrdbmapping;
83         Quit;
84         
85         
86         
87         /* append all codeset data sets */
88         Data ALLcodeset;
89          /*if a unique id has > 7, it may cuase the extra char lost*/
90          format Unique_ID $7. RDB_Attribute $32.;
91          Set rdbdata.imrdbmapping;
92          Rename RDB_Table=TBL_NM RDB_Attribute=COL_NM;
93          Drop Unique_Name Description DB_Table DB_Field Other_Attributes;
94         Run;
95         
96         Proc Sort Data=ALLcodeset;
97          By Unique_ID;
98         Run;
99         Proc Sort Data=nbsfmt.totalidm out=totalidm;
100         By Unique_ID;
101        Run;
102        
103        /*NBS inserted RUB91a instead of RUB091a, we can change imRDBmapping and totalIDM,
104        or add  change here to chnge the unique_ID from RUB091a to RUB91a
105        for ALLcodeset and totalidm before joining the datasets*/
106        
107        
108        /* join totalidm to rdbcodeset to get Code_Set_Nm */
109        Data RDBCodeset;
110         Merge
111        		totalidm (rename=(srt_reference=code_set_nm) drop=format)
112        		ALLcodeset (in=B);
113         By Unique_ID;
114         if B;
115         Rename Unique_ID=CD;
116         format cd_desc $300.;
117         cd_desc = label;
118         drop label;
119        Run;
120        
121        /*get Code_Set information (system, version, etc.) from Srt */
122        Data SRTcodeset;
123         Set nbs_srt.Codeset (KEEP=code_set_nm code_set_desc_txt source_version_txt);
124         Rename code_set_desc_txt=CD_DESC
125                source_version_txt=CD_SYS_VER;
126         /* always select first entry */
127         DROP seq_num;
128        Run;
4                                           The SAS System          10:36 Wednesday, December 13, 2023

129        
130        Proc Sort Data=SRTcodeset;
131          By code_set_nm;
132        Run;
133        
134        Proc Sort Data=RDBcodeset;
135          By code_set_nm;
136        Run;
137        
138        /* Join RDBCodeset and SRTCodeset */
139        Data rdbdata.Codeset;
140         Merge RDBCodeset(in=a) SRTcodeset;
141         By code_set_nm;
142         If a;
143        Run;
144        
145        
146        
147        
148        /**************************************/
149        /* CODE_VALUE_GENERAL TABLE */
150        
151        /* join Codeset and Code_Value_General on Code_Set_Nm */
152        
153        Proc SQL;
154         Create table rdbdata.code_val_general as
155          select a.cd, b.code as CODE_VAL,
156                 b.code_short_desc_txt as CODE_DESC,
157                 b.code_system_cd as CODE_SYS_CD,
158                 b.code_system_desc_txt as CODE_SYS_CD_DESC,
159                 b.effective_from_time as CODE_EFF_DT,
160        		 b.effective_to_time as CODE_END_DT
161           from rdbdata.Codeset a, nbs_srt.Code_Value_General b
162           where a.code_set_nm = b.code_set_nm;
163        Quit;
164        
165        data rdbdata.code_val_general;
166        set rdbdata.code_val_general;
167        	code_key = _n_;
168        run;
169        
170        
171        
172        Data _null_;
173        if 0 then set rdbdata.codeset nobs=n_codeset;
174        if 0 then set rdbdata.code_val_general nobs=n_cvg;
175        call symput('n_codeset',put(n_codeset, 8.));
176        call symput('n_cvg',put(n_cvg, 8.));
177        stop;
178        run;
179        %put &n_codeset;
180        
181        
182        %if &n_codeset ~= 0 and &n_cvg ~= 0 %then %do;
5                                           The SAS System          10:36 Wednesday, December 13, 2023

183        	%dbdelete(code_val_general);
184        	%dbdelete(codeset);
185        	%dbload(codeset, rdbdata.codeset);
186        	%dbload(code_val_general, rdbdata.code_val_general);
187        	%end;
188        %else
189        	%put Check these two files: totalIDM.xls and imRDBmapping.xls.;
190        %mend loadCodeSet;
191        %loadCodeSet;
NOTE: Libref NBS_ODS was successfully assigned as follows: 
      Engine:        ODBC 
      Physical Name: nedss1
NOTE: Libref NBS_SRT was successfully assigned as follows: 
      Engine:        ODBC 
      Physical Name: nbs_srt
NOTE: Libref NBS_RDB was successfully assigned as follows: 
      Engine:        ODBC 
      Physical Name: nbs_rdb
NOTE: Table NBSFMT.TOTALIDM created, with 3725 rows and 4 columns.

NOTE: PROCEDURE SQL used (Total process time):
      real time           0.07 seconds
      cpu time            0.04 seconds
      

NOTE: Table RDBDATA.IMRDBMAPPING created, with 1171 rows and 9 columns.

NOTE: PROCEDURE SQL used (Total process time):
      real time           0.05 seconds
      cpu time            0.06 seconds
      


WARNING: Multiple lengths were specified for the variable Unique_ID by input data set(s). This may 
         cause truncation of data.
WARNING: Multiple lengths were specified for the variable RDB_Attribute by input data set(s). This 
         may cause truncation of data.
NOTE: There were 1171 observations read from the data set RDBDATA.IMRDBMAPPING.
NOTE: The data set WORK.ALLCODESET has 1171 observations and 4 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
      


NOTE: There were 1171 observations read from the data set WORK.ALLCODESET.
NOTE: The data set WORK.ALLCODESET has 1171 observations and 4 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.02 seconds
      cpu time            0.00 seconds
      


NOTE: There were 3725 observations read from the data set NBSFMT.TOTALIDM.
6                                           The SAS System          10:36 Wednesday, December 13, 2023

NOTE: The data set WORK.TOTALIDM has 3725 observations and 4 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.00 seconds
      cpu time            0.01 seconds
      


NOTE: There were 3725 observations read from the data set WORK.TOTALIDM.
NOTE: There were 1171 observations read from the data set WORK.ALLCODESET.
NOTE: The data set WORK.RDBCODESET has 1171 observations and 6 variables.
NOTE: DATA statement used (Total process time):
      real time           0.02 seconds
      cpu time            0.00 seconds
      


WARNING: The variable seq_num in the DROP, KEEP, or RENAME list has never been referenced.
NOTE: There were 1256 observations read from the data set NBS_SRT.Codeset.
NOTE: The data set WORK.SRTCODESET has 1256 observations and 3 variables.
NOTE: DATA statement used (Total process time):
      real time           0.04 seconds
      cpu time            0.01 seconds
      


NOTE: There were 1256 observations read from the data set WORK.SRTCODESET.
NOTE: The data set WORK.SRTCODESET has 1256 observations and 3 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.01 seconds
      cpu time            0.01 seconds
      


NOTE: There were 1171 observations read from the data set WORK.RDBCODESET.
NOTE: The data set WORK.RDBCODESET has 1171 observations and 6 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.02 seconds
      cpu time            0.01 seconds
      


WARNING: Multiple lengths were specified for the BY variable code_set_nm by input data sets. This may 
         cause unexpected results.
WARNING: Multiple lengths were specified for the variable cd_desc by input data set(s). This may 
         cause truncation of data.
NOTE: There were 1171 observations read from the data set WORK.RDBCODESET.
NOTE: There were 1256 observations read from the data set WORK.SRTCODESET.
NOTE: The data set RDBDATA.CODESET has 1171 observations and 7 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.01 seconds
      

NOTE: Table RDBDATA.CODE_VAL_GENERAL created, with 10131 rows and 7 columns.
7                                           The SAS System          10:36 Wednesday, December 13, 2023


NOTE: PROCEDURE SQL used (Total process time):
      real time           0.23 seconds
      cpu time            0.07 seconds
      


NOTE: There were 10131 observations read from the data set RDBDATA.CODE_VAL_GENERAL.
NOTE: The data set RDBDATA.CODE_VAL_GENERAL has 10131 observations and 8 variables.
NOTE: DATA statement used (Total process time):
      real time           0.04 seconds
      cpu time            0.03 seconds
      


NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.01 seconds
      

1171
NOTE: PROCEDURE SQL used (Total process time):
      real time           0.04 seconds
      cpu time            0.01 seconds
      

NOTE: PROCEDURE SQL used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
      


NOTE: Appending RDBDATA.CODESET to NBS_RDB.codeset.
WARNING: Variable condition_cd was not found on BASE file. The variable will not be added to the BASE 
         file.
WARNING: Variable CD has different lengths on BASE and DATA files (BASE 20 DATA 255).
WARNING: Variable TBL_NM has different lengths on BASE and DATA files (BASE 32 DATA 255).
WARNING: Variable DATA_TYPE was not found on DATA file.
WARNING: Variable DATA_LENGTH was not found on DATA file.
WARNING: Variable CODE_SET_NM has different lengths on BASE and DATA files (BASE 256 DATA 255).
NOTE: FORCE is specified, so dropping/truncating will occur.
NOTE: There were 1171 observations read from the data set RDBDATA.CODESET.
NOTE: 1171 observations added.
NOTE: The data set NBS_RDB.codeset has . observations and 8 variables.
NOTE: PROCEDURE APPEND used (Total process time):
      real time           1.01 seconds
      cpu time            0.14 seconds
      


NOTE: Appending RDBDATA.CODE_VAL_GENERAL to NBS_RDB.code_val_general.
WARNING: Variable CODE_VAL has different lengths on BASE and DATA files (BASE 50 DATA 20).
WARNING: Variable CODE_DESC has different lengths on BASE and DATA files (BASE 300 DATA 100).
WARNING: Variable CODE_SYS_CD has different lengths on BASE and DATA files (BASE 50 DATA 300).
8                                           The SAS System          10:36 Wednesday, December 13, 2023

WARNING: Variable CODE_SYS_CD_DESC has different lengths on BASE and DATA files (BASE 50 DATA 100).
WARNING: Variable CD has different lengths on BASE and DATA files (BASE 20 DATA 255).
NOTE: FORCE is specified, so dropping/truncating will occur.
NOTE: There were 10131 observations read from the data set RDBDATA.CODE_VAL_GENERAL.
NOTE: 10131 observations added.
NOTE: The data set NBS_RDB.code_val_general has . observations and 8 variables.
NOTE: PROCEDURE APPEND used (Total process time):
      real time           8.07 seconds
      cpu time            0.29 seconds
      

2832       
2833       
2834       
2835       
2836       

NOTE: SAS Institute Inc., SAS Campus Drive, Cary, NC USA 27513-2414
NOTE: The SAS System used:
      real time           10.37 seconds
      cpu time            1.18 seconds
      
